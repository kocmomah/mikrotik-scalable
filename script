:local githubUrl "https://raw.githubusercontent.com/yourname/social-blocklist/main/social-blocklist.txt"
:local listName "social-blocklist"
:local tempFile "social-blocklist-temp.txt"

# Удаляем старый временный файл, если он есть
:if ([file find name=$tempFile] != "") do={
    :log info ("Removing old temp file: " . $tempFile)
    /file remove $tempFile
}

# Удаляем старый список
:log info ("Removing old address-list: " . $listName)
/ip firewall address-list remove [find list=$listName]

# Скачиваем список
/tool fetch url=$githubUrl dst-path=$tempFile mode=http

# Проверяем, скачался ли файл
:if ([file get $tempFile size] > 0) do={
    :log info ("File downloaded: " . $tempFile . ", size: " . [:tonum [file get $tempFile size]])
    :local content [/file get $tempFile contents]
    :local lines [:toarray $content]
    :local count 0

    :foreach line in=$lines do={
        :set line [:tostr $line]
        :if ([:len [:pick $line 0 1]] > 0) do={
            :if ([:pick $line 0 1] != "#") do={
                :if ([:len [:tostr $line]] > 0) do={
                    /ip firewall address-list add list=$listName address=$line comment="Auto-imported from GitHub"
                    :set count ($count + 1)
                    :log info ("Added to address-list: " . $line)
                }
            }
        }
    }

    :log info ("Total entries added to " . $listName . ": " . $count)
    /file remove $tempFile
} else={
    :log error ("Failed to download or file is empty: " . $githubUrl)
}
